# Verbindungsarchitektur - Quarto Multiplayer

## ğŸ—ï¸ System-Ãœbersicht

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Client (Browser)                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚           useMultiplayerSSE Hook                      â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚  EventSource (SSE)                              â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  - Echtzeit-Updates                            â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  - Heartbeat alle 15s                          â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  - Automatischer Reconnect                     â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚                         â†•                             â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚  Fallback Polling                               â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  - Aktiviert bei SSE-Timeout (>25s)            â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  - PrÃ¼ft alle 3s                               â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  - LÃ¤dt State manuell                          â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚                         â†•                             â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚  Connection Check                               â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  - PrÃ¼ft alle 5s                               â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  - Ãœberwacht ReadyState                        â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  - Triggert Reconnect                          â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚           Browser Event Listeners                     â”‚  â”‚
â”‚  â”‚  - visibilitychange (Tab-Wechsel)                    â”‚  â”‚
â”‚  â”‚  - online/offline (Netzwerk)                         â”‚  â”‚
â”‚  â”‚  - beforeunload (Cleanup)                            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â”‚ HTTP/SSE
                            â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Server (Next.js)                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚           API Routes                                  â”‚  â”‚
â”‚  â”‚                                                        â”‚  â”‚
â”‚  â”‚  /api/room/create     - Raum erstellen               â”‚  â”‚
â”‚  â”‚  /api/room/join       - Raum beitreten               â”‚  â”‚
â”‚  â”‚  /api/room/state      - State lesen/schreiben        â”‚  â”‚
â”‚  â”‚  /api/room/subscribe  - SSE-Verbindung               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                         â†•                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚           SSE Connection Manager                      â”‚  â”‚
â”‚  â”‚  (lib/sseConnections.ts)                             â”‚  â”‚
â”‚  â”‚                                                        â”‚  â”‚
â”‚  â”‚  - Map<RoomId, Set<Controller>>                      â”‚  â”‚
â”‚  â”‚  - addConnection()                                    â”‚  â”‚
â”‚  â”‚  - removeConnection()                                 â”‚  â”‚
â”‚  â”‚  - broadcastRoomUpdate()                             â”‚  â”‚
â”‚  â”‚  - Heartbeat-Sender                                  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                         â†•                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚           Room Storage                                â”‚  â”‚
â”‚  â”‚  (lib/roomStorage.ts)                                â”‚  â”‚
â”‚  â”‚                                                        â”‚  â”‚
â”‚  â”‚  - Map<RoomId, RoomData>                             â”‚  â”‚
â”‚  â”‚  - createRoom()                                       â”‚  â”‚
â”‚  â”‚  - getRoom()                                          â”‚  â”‚
â”‚  â”‚  - updateRoom()                                       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”„ Verbindungsfluss

### 1. Normale Verbindung

```
Client                          Server
  â”‚                               â”‚
  â”œâ”€â”€â”€ POST /api/room/create â”€â”€â”€â”€>â”‚
  â”‚<â”€â”€â”€ { roomId, gameState } â”€â”€â”€â”€â”¤
  â”‚                               â”‚
  â”œâ”€â”€â”€ GET /api/room/subscribe â”€â”€>â”‚
  â”‚<â”€â”€â”€ SSE Stream opened â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚<â”€â”€â”€ data: { type: 'state' } â”€â”€â”€â”¤
  â”‚                               â”‚
  â”‚<â”€â”€â”€ : heartbeat â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ (alle 15s)
  â”‚<â”€â”€â”€ : heartbeat â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚                               â”‚
  â”œâ”€â”€â”€ POST /api/room/state â”€â”€â”€â”€â”€>â”‚ (Spielzug)
  â”‚<â”€â”€â”€ 200 OK â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚<â”€â”€â”€ data: { type: 'state' } â”€â”€â”€â”¤ (Broadcast)
  â”‚                               â”‚
```

### 2. Verbindung mit Unterbrechung

```
Client                          Server
  â”‚                               â”‚
  â”‚<â”€â”€â”€ SSE Stream â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚                               â”‚
  âœ— Netzwerk-Unterbrechung
  â”‚                               â”‚
  â”‚ [Fallback Polling startet]    â”‚
  â”‚                               â”‚
  â”œâ”€â”€â”€ GET /api/room/state â”€â”€â”€â”€â”€â”€>â”‚ (alle 3s)
  â”‚<â”€â”€â”€ { gameState } â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚                               â”‚
  â”‚ [Reconnect Versuch 1]         â”‚
  â”œâ”€â”€â”€ GET /api/room/subscribe â”€â”€>â”‚
  âœ— Fehlgeschlagen                â”‚
  â”‚                               â”‚
  â”‚ [Warte 1s]                    â”‚
  â”‚                               â”‚
  â”‚ [Reconnect Versuch 2]         â”‚
  â”œâ”€â”€â”€ GET /api/room/subscribe â”€â”€>â”‚
  â”‚<â”€â”€â”€ SSE Stream opened â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚<â”€â”€â”€ data: { type: 'state' } â”€â”€â”€â”¤ (State-Sync)
  â”‚                               â”‚
  â”‚ [Fallback Polling stoppt]     â”‚
  â”‚                               â”‚
  âœ“ Verbindung wiederhergestellt  â”‚
```

### 3. Tab-Wechsel-Szenario

```
Client                          Server
  â”‚                               â”‚
  â”‚<â”€â”€â”€ SSE Stream â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚                               â”‚
  ğŸ”½ Tab wird inaktiv
  â”‚ [Browser drosselt Timers]     â”‚
  â”‚                               â”‚
  â”‚<â”€â”€â”€ : heartbeat â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ (verzÃ¶gert)
  â”‚                               â”‚
  ğŸ”¼ Tab wird aktiv
  â”‚ [visibilitychange Event]      â”‚
  â”‚                               â”‚
  â”‚ [Check: Letzte Nachricht?]    â”‚
  â”‚ â†’ Mehr als 5s her             â”‚
  â”‚                               â”‚
  â”‚ [Erzwinge Reconnect]          â”‚
  â”œâ”€â”€â”€ GET /api/room/subscribe â”€â”€>â”‚
  â”‚<â”€â”€â”€ SSE Stream opened â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚<â”€â”€â”€ data: { type: 'state' } â”€â”€â”€â”¤
  â”‚                               â”‚
  âœ“ Synchronisiert                â”‚
```

## ğŸ›¡ï¸ Fehlerbehandlung

### Exponential Backoff

```
Versuch 1: Warte 1.0s   â”€â”€â”€â”€â”
Versuch 2: Warte 1.5s       â”‚ Exponential
Versuch 3: Warte 2.25s      â”‚ Backoff
Versuch 4: Warte 3.38s      â”‚ (Faktor 1.5)
Versuch 5: Warte 5.06s      â”‚
...                         â”‚
Versuch N: Warte 30s    â”€â”€â”€â”€â”˜ (Maximum)
```

### Mehrschichtiger Schutz

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Ebene 1: SSE (Echtzeit)            â”‚ â† PrimÃ¤r
â”‚  - 0ms Latenz                       â”‚
â”‚  - Heartbeat alle 15s               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“ (bei Timeout >25s)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Ebene 2: Fallback Polling          â”‚ â† SekundÃ¤r
â”‚  - 3s Latenz                        â”‚
â”‚  - PrÃ¼ft alle 3s                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“ (bei Reconnect)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Ebene 3: State-Synchronisation     â”‚ â† TertiÃ¤r
â”‚  - Einmalig nach Reconnect          â”‚
â”‚  - Garantiert Konsistenz            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“Š State-Management

### Optimistisches Update

```
User-Aktion (z.B. Spielzug)
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. UI sofort aktualisieren     â”‚ â† Optimistisch
â”‚     (previousState gespeichert) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2. POST /api/room/state        â”‚ â† Server-Sync
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  3a. Erfolg â†’ State behalten    â”‚ â† Happy Path
â”‚  3b. Fehler â†’ Rollback          â”‚ â† Error Path
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  4. SSE Broadcast an alle       â”‚ â† Propagierung
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ” Monitoring-Punkte

### Client-seitig

```
[SSE]               - SSE-Verbindungsstatus
[FALLBACK]          - Fallback-Polling-AktivitÃ¤t
[CONNECTION CHECK]  - Aktive VerbindungsprÃ¼fung
[UPDATE]            - State-Updates
[VISIBILITY]        - Tab-Visibility-Events
[NETWORK]           - Online/Offline-Events
```

### Server-seitig

```
[SSE] ğŸ”Œ            - Neue Verbindung
[SSE] ğŸ’“            - Heartbeat gesendet
[SSE] ğŸ“¡            - Broadcasting Update
[SSE] âŒ            - Fehler beim Senden
[SSE] ğŸ§¹            - Tote Verbindungen entfernt
```

## ğŸ¯ Performance-Charakteristiken

### Latenz

| Szenario | Latenz | ErklÃ¤rung |
|----------|--------|-----------|
| SSE (normal) | ~0-50ms | Echtzeit-Push vom Server |
| Fallback Polling | ~1.5s | Durchschnitt bei 3s Intervall |
| Reconnect | ~1-30s | AbhÃ¤ngig von Versuch-Nummer |
| Tab-Aktivierung | ~100ms | Sofortiger Check + Reconnect |

### Netzwerk-Traffic

| Komponente | Traffic | Frequenz |
|------------|---------|----------|
| Heartbeat | ~10 Bytes | Alle 15s |
| State-Update | ~1-2 KB | Bei Spielzug |
| Fallback-Poll | ~1-2 KB | Alle 3s (nur bei SSE-Ausfall) |
| Reconnect | ~1-2 KB | Bei Verbindungsproblemen |

**Gesamt (normal):** ~2.4 KB/Stunde (nur Heartbeats)
**Gesamt (Fallback):** ~1.2 MB/Stunde (kontinuierliches Polling)

### Ressourcen

| Ressource | Client | Server |
|-----------|--------|--------|
| Memory | ~50 KB | ~1-2 KB pro Verbindung |
| CPU | <1% | <1% pro Verbindung |
| Connections | 1 SSE | 1 pro Client |
| Timers | 3 Intervals | 1 Interval pro Verbindung |

## ğŸ” SicherheitsÃ¼berlegungen

### Rate Limiting

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  MIN_UPDATE_INTERVAL: 100ms     â”‚ â† Client-seitig
â”‚  - Verhindert Spam              â”‚
â”‚  - Debouncing von Updates       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Verbindungs-Cleanup

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Automatische Cleanup bei:      â”‚
â”‚  - Client disconnect            â”‚
â”‚  - Tote Verbindungen            â”‚
â”‚  - Page unload                  â”‚
â”‚  - Component unmount            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸš€ Skalierbarkeit

### Aktuelle Architektur (In-Memory)

```
Server (Single Instance)
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Room Storage (Map)             â”‚
â”‚  - Begrenzt auf Server-RAM      â”‚
â”‚  - Verloren bei Neustart        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SSE Connections (Map)          â”‚
â”‚  - Max ~1000 gleichzeitige      â”‚
â”‚  - AbhÃ¤ngig von Server-Limits   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ZukÃ¼nftige Skalierung (Redis)

```
Load Balancer
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Server 1   â”‚  Server 2   â”‚  Server 3   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â†“
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚  Redis PubSub   â”‚
            â”‚  - Shared State â”‚
            â”‚  - Broadcasting â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“š Weitere Ressourcen

- **Code:** `hooks/useMultiplayerSSE.ts`
- **Server:** `app/api/room/subscribe/route.ts`
- **Config:** `config/connection.ts`
- **Docs:** `docs/VERBINDUNGSSTABILITAET.md`
